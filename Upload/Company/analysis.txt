DECLARE @DynamicPivotQuery AS NVARCHAR(MAX) DECLARE @ColumnName AS NVARCHAR(MAX) SELECT @ColumnName = ISNULL(@ColumnName + ',','') + QUOTENAME(Description) FROM (SELECT description FROM Mst_TaskStatus) AS Weeks SET @DynamicPivotQuery = ' SELECT * FROM ( select taskStatus.Description, task.ToTaskStatusId as No, case when task.UserId in (select UserId from Mst_User where UserTypeId = 2) then ''Process Owner'' when (task.UserId in (select UserId from Mst_User where UserTypeId = 1  and (IsAdmin = ''True'' or IsSuperAdmin = ''True'')) and (task.FunctionalityId = '''' or task.FunctionalityId = 0 or task.FunctionalityId is null))
then ''Quick Task'' when task.UserId in (select UserId from Mst_User where UserTypeId = 1  and (IsAdmin = ''True'' or IsSuperAdmin = ''True'')) then ''Admin'' when task.UserId in (select UserId from Mst_User where UserTypeId = 1  and (IsAdmin = ''False'' or IsSuperAdmin = ''False'')) and (select COUNT(*) from Trn_TaskHistory where TaskId = task.TaskId) = 1
then ''Non Admin'' end as TaskByUserType  from Trn_Task task inner join Mst_TaskStatus taskStatus on task.ToTaskStatusId = TaskStatus.TaskStatusId left join Trn_TaskHistory TaskHistory on TaskHistory.TaskId = task.TaskId and TaskHistory.TaskHistoryId = (select top(1) TaskHistory2.TaskHistoryId from Trn_TaskHistory TaskHistory2 where TaskHistory2.TaskId = task.TaskId order by TaskHistory2.TaskHistoryId desc) where task.TaskId ! = 0  and (task.CreatedByUserrId = 13) or (task.taskid in (select distinct TaskId from Trn_TaskHistory where ToTeamMemberId = 13)) and task.CompanyId = 1 and task.active = 1 Union all select  ''total'' as total,task.taskid as No, case when task.UserId in (select UserId from Mst_User where UserTypeId = 2) then ''Process Owner'' when (task.UserId in (select UserId from Mst_User where UserTypeId = 1  and (IsAdmin = ''True'' or IsSuperAdmin = ''True'')) and (task.FunctionalityId = '''' or task.FunctionalityId = 0 or task.FunctionalityId is null))
then ''Quick Task'' when task.UserId in (select UserId from Mst_User where UserTypeId = 1  and (IsAdmin = ''True'' or IsSuperAdmin = ''True'')) then ''Admin'' when task.UserId in (select UserId from Mst_User where UserTypeId = 1  and (IsAdmin = ''False'' or IsSuperAdmin = ''False'')) and (select COUNT(*) from Trn_TaskHistory where TaskId = task.TaskId) = 1
then ''Non Admin'' end as TaskByUserType from Trn_Task task left join Trn_TaskHistory TaskHistory on TaskHistory.TaskId = task.TaskId and TaskHistory.TaskHistoryId = (select top(1) TaskHistory2.TaskHistoryId from Trn_TaskHistory TaskHistory2 where TaskHistory2.TaskId = task.TaskId order by TaskHistory2.TaskHistoryId desc) where task.TaskId ! = 0  and (task.CreatedByUserrId = 13) or (task.taskid in (select distinct TaskId from Trn_TaskHistory where ToTeamMemberId = 13)) and task.CompanyId = 1 and task.active = 1) as s PIVOT ( Count(No) FOR [Description] in ('+  @ColumnName +', Total) )AS pvt' exec sp_executesql @DynamicPivotQuery